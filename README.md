# 🏗️ Basic Gantt Scheduler - 基礎Bar Chart排程工具

一個輕量化的自動Bar Chart生成工具，基於要徑法 (Critical Path Method, CPM) 的專案排程系統。

## ✨ 功能特點

- **最少輸入，立即出圖**：只需輸入作業名稱、工期、前/後作業即可
- **自動 CPM 計算**：自動執行要徑法運算
  - Forward Pass（前向計算）
  - Backward Pass（後向計算）
  - 浮時計算（TF/FF）
  - 要徑識別
- **視覺化展示**：
  - 詳細 CPM 計算結果表格
  - **分頁式圖表區**：一鍵切換不同視圖
    - 📊 互動式Bar Chart（使用 D3.js）
    - 🔗 PDM 節點式網圖（Precedence Diagramming Method）
  - 要徑高亮顯示
  - 依賴關係連線與類型標示（FS/SS/FF/SF）
- **資料管理**：
  - CSV 匯入/匯出
  - 要徑報告生成
  - 專案資料儲存
- **錯誤偵測**：
  - 循環依賴檢測
  - 資料完整性驗證
  - 即時錯誤提示

## 🚀 快速開始

### 安裝依賴

```bash
npm install
```

### 開發模式

```bash
npm run dev
```

### 建置生產版本

```bash
npm run build
```

### 預覽生產版本

```bash
npm run preview
```

## 📖 使用說明

### 1. 新增作業

在作業輸入區域填寫：
- **作業名稱**：例如「基礎開挖」、「結構施工」
- **工期（天）**：該作業所需的工作天數
- **前置作業**：此作業開始前必須完成的作業（可選，支援多選）
  - 點擊可用作業前的 + 按鈕來新增
  - 點擊已選作業的 × 按鈕來移除
- **後續作業**：此作業完成後可開始的作業（可選，支援多選）
  - 點擊可用作業前的 + 按鈕來新增
  - 點擊已選作業的 × 按鈕來移除

點擊「新增作業」按鈕即可新增。

### 2. 計算排程

新增完所有作業後，點擊「計算排程」按鈕，系統將自動：
- 執行 CPM 計算
- 識別要徑
- 生成Bar Chart
- 顯示詳細結果

### 3. 查看結果

#### CPM 計算結果表格
顯示每個作業的：
- ES (Earliest Start)：最早開始時間
- EF (Earliest Finish)：最早完成時間
- LS (Latest Start)：最晚開始時間
- LF (Latest Finish)：最晚完成時間
- TF (Total Float)：總浮時
- FF (Free Float)：自由浮時
- 是否為要徑作業

#### 視覺化圖表（分頁切換）

計算結果下方提供兩種視覺化圖表，可透過分頁快速切換：

**📊 Bar Chart**
- 時間軸顯示專案時程
- 任務條顯示作業工期
- 要徑以紅色標示
- 依賴關係以箭頭連線
- 支援放大/縮小/重置功能

**🔗 PDM 網圖**
- **兩種顯示模式**：
  - **簡潔模式**（預設）：綠色配色，小型節點，只顯示作業名稱，類似傳統手繪網圖
  - **詳細模式**：九宮格節點，顯示完整 CPM 資訊（ES/EF/LS/LF/工期/TF）
- **橫向佈局**：從左到右按時間順序排列，符合傳統 PDM 規範
- **智能路徑規劃**（滿足：不穿過節點、減少彎曲、不會重疊）：
  - **優先直線**：無障礙時使用直線（零彎曲）
  - **三段式路徑**：標準情況使用三段式（兩個彎）
  - **自動避障**：檢測障礙物並智能繞行
  - **防止重疊**：相似路徑交替偏移，保持清晰
  - **最少彎曲**：四階層路徑策略，優先簡潔路徑
- 標示依賴類型（FS/SS/FF/SF）和 Lag 值
- 要徑以紅色高亮顯示
- 支援拖曳、縮放、自動適配視窗
- 可切換顯示/隱藏詳細資訊
- 點擊節點顯示完整作業細節

### 4. 匯入/匯出

#### 匯入 CSV
點擊「匯入 CSV」按鈕，選擇包含作業資料的 CSV 檔案。

CSV 格式範例：
```csv
作業名稱,工期(天),前置作業,後續作業
地質調查,5,,初步設計
初步設計,10,地質調查,結構設計
結構設計,15,初步設計,發包準備
```

#### 匯出功能
- **匯出作業**：將當前作業列表匯出為 CSV
- **匯出結果**：將 CPM 計算結果匯出為 CSV
- **匯出報告**：生成完整的要徑分析報告

#### 下載範本
點擊「下載範本」可下載標準的 CSV 範本檔案。

## 🎯 應用場景

- **營建管理學生**：課堂作業、專題展示
- **顧問工程師**：快速向業主呈現施工邏輯
- **專案經理**：早期規劃階段的排程分析
- **地主/更新戶**：理解施工時程與關聯

## 🏗️ 技術架構

- **前端框架**：Vue 3 + TypeScript
- **視覺化**：D3.js
- **建構工具**：Vite
- **樣式**：CSS3

## 📊 CPM 演算法

系統採用標準的要徑法（CPM），執行步驟如下：

1. **依賴關係驗證**
   - 檢查循環依賴
   - 驗證資料完整性

2. **拓樸排序**
   - 使用 Kahn's Algorithm
   - 確保任務執行順序

3. **Forward Pass**
   - ES = max(EF of predecessors)
   - EF = ES + Duration

4. **Backward Pass**
   - LF = min(LS of successors)
   - LS = LF - Duration

5. **浮時計算**
   - TF = LS - ES（總浮時）
   - FF = min(ES of successors) - EF（自由浮時）

6. **要徑識別**
   - 找出所有 TF = 0 的任務

## 📝 範例資料

系統內建範例（可透過下載範本取得）：

```
作業: 地質調查 → 初步設計 → 結構設計 → 發包準備 → 開工動員
工期: 5天 → 10天 → 15天 → 7天 → 3天
總工期: 40 天
要徑: 所有作業皆為要徑作業
```

## 🔧 瀏覽器支援

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## 📄 授權

© 2025 Basic Gantt Scheduler v1.1

作者：張凱博

## 🤝 貢獻

歡迎提出問題和改進建議！

## 📮 聯絡方式

如有任何問題或建議，請透過 Issue 功能聯繫。

---

**v1.2 更新內容**
- ✨ 新增 PDM 節點式網圖視覺化
- 支援完整的四種依賴類型（FS/SS/FF/SF）和 Lag 值顯示
- 互動式網圖：拖曳、縮放、節點點擊查看詳情
- 自動佈局演算法，清晰呈現專案邏輯

**v1.1 更新內容**
- 完整的 CPM 計算引擎
- 互動式Bar Chart視覺化
- CSV 匯入/匯出功能
- 要徑報告生成
- 循環依賴偵測
- 響應式設計
